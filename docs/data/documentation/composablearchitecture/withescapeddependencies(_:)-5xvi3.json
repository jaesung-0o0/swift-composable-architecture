{"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/withEscapedDependencies(_:)-5xvi3"},"metadata":{"title":"withEscapedDependencies(_:)","modules":[{"name":"ComposableArchitecture"}],"symbolKind":"func","fragments":[{"text":"func","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"withEscapedDependencies"},{"text":"<","kind":"text"},{"kind":"genericParameter","text":"R"},{"text":">((","kind":"text"},{"preciseIdentifier":"s:12Dependencies16DependencyValuesV","text":"DependencyValues","kind":"typeIdentifier"},{"kind":"text","text":"."},{"preciseIdentifier":"s:12Dependencies16DependencyValuesV12ContinuationV","text":"Continuation","kind":"typeIdentifier"},{"text":") ","kind":"text"},{"kind":"keyword","text":"throws"},{"text":" -> ","kind":"text"},{"text":"R","kind":"typeIdentifier"},{"kind":"text","text":") "},{"text":"rethrows","kind":"keyword"},{"text":" -> ","kind":"text"},{"text":"R","kind":"typeIdentifier"}],"role":"symbol","externalID":"s:12Dependencies011withEscapedA0yxxAA16DependencyValuesV12ContinuationVKXEKlF","roleHeading":"Function"},"abstract":[{"text":"Propagates the current dependencies to an escaping context.","type":"text"}],"schemaVersion":{"minor":3,"major":0,"patch":0},"variants":[{"paths":["\/documentation\/composablearchitecture\/withescapeddependencies(_:)-5xvi3"],"traits":[{"interfaceLanguage":"swift"}]}],"primaryContentSections":[{"declarations":[{"tokens":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"withEscapedDependencies","kind":"identifier"},{"kind":"text","text":"<"},{"text":"R","kind":"genericParameter"},{"kind":"text","text":">("},{"kind":"externalParam","text":"_"},{"text":" ","kind":"text"},{"text":"operation","kind":"internalParam"},{"kind":"text","text":": ("},{"preciseIdentifier":"s:12Dependencies16DependencyValuesV","identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues","text":"DependencyValues","kind":"typeIdentifier"},{"text":".","kind":"text"},{"kind":"typeIdentifier","identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues\/Continuation","text":"Continuation","preciseIdentifier":"s:12Dependencies16DependencyValuesV12ContinuationV"},{"text":") ","kind":"text"},{"text":"throws","kind":"keyword"},{"kind":"text","text":" -> "},{"text":"R","kind":"typeIdentifier"},{"text":") ","kind":"text"},{"text":"rethrows","kind":"keyword"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"R"}],"languages":["swift"],"platforms":["iOS"]}],"kind":"declarations"},{"parameters":[{"content":[{"type":"paragraph","inlineContent":[{"text":"A closure that takes a ","type":"text"},{"identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues\/Continuation","type":"reference","isActive":true},{"text":" value for","type":"text"},{"text":" ","type":"text"},{"text":"propagating dependencies past an escaping closure boundary.","type":"text"}]}],"name":"operation"}],"kind":"parameters"},{"kind":"content","content":[{"level":2,"type":"heading","anchor":"discussion","text":"Discussion"},{"type":"paragraph","inlineContent":[{"text":"This helper takes a trailing closure that is provided an ","type":"text"},{"identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues\/Continuation","type":"reference","isActive":true},{"text":" ","type":"text"},{"text":"value, which can be used to access dependencies in an escaped context. It is useful in","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"situations where you cannot leverage structured concurrency and must use escaping closures."},{"text":" ","type":"text"},{"type":"text","text":"Dependencies do not automatically propagate across escaping boundaries like they do in"},{"text":" ","type":"text"},{"text":"structured contexts and in ","type":"text"},{"type":"codeVoice","code":"Task"},{"text":"s.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"For example, suppose you want to use "},{"type":"codeVoice","code":"DispatchQueue.main.asyncAfter"},{"text":" to execute some logic after","type":"text"},{"text":" ","type":"text"},{"text":"a delay, and that logic needs to make use of dependencies. In order to guarantee that","type":"text"},{"text":" ","type":"text"},{"text":"dependencies used in the escaping closure of ","type":"text"},{"code":"asyncAfter","type":"codeVoice"},{"text":" reflect the correct values, you should","type":"text"},{"type":"text","text":" "},{"text":"use ","type":"text"},{"code":"withEscapedDependencies","type":"codeVoice"},{"text":":","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["withEscapedDependencies { dependencies in","  DispatchQueue.main.asyncAfter(deadline: .now() + 1) {","    dependencies.yield {","      \/\/ All code in here will use dependencies at the time of calling withEscapedDependencies.","    }","  }","}"]},{"inlineContent":[{"type":"text","text":"As a general rule, you should surround "},{"inlineContent":[{"type":"text","text":"all"}],"type":"emphasis"},{"type":"text","text":" escaping code that may access dependencies with"},{"type":"text","text":" "},{"text":"this helper, and you should use ","type":"text"},{"type":"reference","identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues\/Continuation\/yield(_:)-42ttb","isActive":true},{"type":"text","text":" "},{"type":"emphasis","inlineContent":[{"text":"immediately","type":"text"}]},{"type":"text","text":" "},{"type":"text","text":"inside the escaping closure. Otherwise you run the risk of the escaped code using the wrong"},{"type":"text","text":" "},{"type":"text","text":"dependencies. But, you should also try your hardest to keep your code in the structured world"},{"type":"text","text":" "},{"type":"text","text":"using Swiftâ€™s tools of structured concurrency, and should avoid using escaping closures."}],"type":"paragraph"},{"inlineContent":[{"text":"If you need to further override dependencies in the escaped closure, do so inside the","type":"text"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues\/Continuation\/yield(_:)-42ttb"},{"text":" and not outside:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["withEscapedDependencies { dependencies in","  DispatchQueue.main.asyncAfter(deadline: .now() + 1) {","    dependencies.yield {","      withDependencies {","        $0.apiClient = .mock","      } operation: {","        \/\/ All code in here will use dependencies at the time of calling","        \/\/ withEscapedDependencies except the API client will be mocked.","      }","    }","  }","}"]}]}],"hierarchy":{"paths":[["doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture"]]},"kind":"symbol","sections":[],"references":{"doc://ComposableArchitecture/documentation/ComposableArchitecture/DependencyValues/Continuation/yield(_:)-42ttb":{"abstract":[{"type":"text","text":"Access the propagated dependencies in an escaping context."}],"title":"yield(_:)","url":"\/documentation\/composablearchitecture\/dependencyvalues\/continuation\/yield(_:)-42ttb","role":"symbol","kind":"symbol","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"yield"},{"kind":"text","text":"<"},{"kind":"genericParameter","text":"R"},{"text":">(() ","kind":"text"},{"kind":"keyword","text":"async"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"kind":"typeIdentifier","text":"R"},{"text":") ","kind":"text"},{"text":"async","kind":"keyword"},{"kind":"text","text":" "},{"kind":"keyword","text":"rethrows"},{"text":" -> ","kind":"text"},{"kind":"typeIdentifier","text":"R"}],"identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues\/Continuation\/yield(_:)-42ttb","type":"topic"},"doc://ComposableArchitecture/documentation/ComposableArchitecture/DependencyValues":{"url":"\/documentation\/composablearchitecture\/dependencyvalues","navigatorTitle":[{"text":"DependencyValues","kind":"identifier"}],"kind":"symbol","abstract":[{"text":"A collection of dependencies that is globally available.","type":"text"}],"role":"symbol","identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues","title":"DependencyValues","type":"topic","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"DependencyValues"}]},"doc://ComposableArchitecture/documentation/ComposableArchitecture":{"identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture","role":"collection","url":"\/documentation\/composablearchitecture","abstract":[{"text":"The Composable Architecture (TCA, for short) is a library for building applications in a consistent","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"and understandable way, with composition, testing, and ergonomics in mind. It can be used in"},{"type":"text","text":" "},{"text":"SwiftUI, UIKit, and more, and on any Apple platform (iOS, macOS, tvOS, and watchOS).","type":"text"}],"type":"topic","kind":"symbol","title":"ComposableArchitecture"},"doc://ComposableArchitecture/documentation/ComposableArchitecture/withEscapedDependencies(_:)-5xvi3":{"kind":"symbol","fragments":[{"text":"func","kind":"keyword"},{"kind":"text","text":" "},{"text":"withEscapedDependencies","kind":"identifier"},{"kind":"text","text":"<"},{"text":"R","kind":"genericParameter"},{"kind":"text","text":">(("},{"text":"DependencyValues","preciseIdentifier":"s:12Dependencies16DependencyValuesV","kind":"typeIdentifier"},{"text":".","kind":"text"},{"kind":"typeIdentifier","text":"Continuation","preciseIdentifier":"s:12Dependencies16DependencyValuesV12ContinuationV"},{"kind":"text","text":") "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"R"},{"kind":"text","text":") "},{"text":"rethrows","kind":"keyword"},{"text":" -> ","kind":"text"},{"kind":"typeIdentifier","text":"R"}],"abstract":[{"text":"Propagates the current dependencies to an escaping context.","type":"text"}],"url":"\/documentation\/composablearchitecture\/withescapeddependencies(_:)-5xvi3","identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/withEscapedDependencies(_:)-5xvi3","role":"symbol","title":"withEscapedDependencies(_:)","type":"topic"},"doc://ComposableArchitecture/documentation/ComposableArchitecture/DependencyValues/Continuation":{"identifier":"doc:\/\/ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues\/Continuation","role":"symbol","navigatorTitle":[{"text":"Continuation","kind":"identifier"}],"url":"\/documentation\/composablearchitecture\/dependencyvalues\/continuation","fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"text":"Continuation","kind":"identifier"}],"abstract":[{"type":"text","text":"A capture of dependencies to use in an escaping context."}],"type":"topic","kind":"symbol","title":"DependencyValues.Continuation"}}}